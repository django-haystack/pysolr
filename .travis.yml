sudo: required
language: python
python:
  - "2.7"
  - "3.3"
  - "3.4"
  - "3.5"
  - "3.6"
  - "pypy"

cache:
  apt: true
  pip: true
  directories:
    - $HOME/download-cache

env:
  - SOLR_VERSION="4.10.4" SOLRCLOUD=false
  - SOLR_VERSION="4.10.4" SOLRCLOUD=true
  - SOLR_VERSION="5.5" SOLRCLOUD=false
  - SOLR_VERSION="5.5" SOLRCLOUD=true
  - SOLR_VERSION="6.6" SOLRCLOUD=false
  - SOLR_VERSION="6.6" SOLRCLOUD=true
  - SOLR_VERSION="7.1" SOLRCLOUD=false
  - SOLR_VERSION="7.1" SOLRCLOUD=true

matrix:
  allow_failures:
    - env: SOLR_VERSION="5.5" SOLRCLOUD=true
    - env: SOLR_VERSION="6.6" SOLRCLOUD=true
    - env: SOLR_VERSION="7.1" SOLRCLOUD=false
    - env: SOLR_VERSION="7.1" SOLRCLOUD=true
    - python: 'pypy'

services:
  - docker

addons:
  apt_packages:
    - default-jdk

before_install:
  - sudo apt-get update
  - sudo apt-get install docker-ce

install:
  - "pip install 'requests>2'"
  - "pip install ."
  - 'if [[ $TRAVIS_PYTHON_VERSION == "2.7" ]]; then travis_retry pip install faulthandler; fi'
  - 'if [[ "${SOLRCLOUD:-false}" == "true" ]]; then pip install -e .[solrcloud]; fi'

script:
  - python run-tests.py

notifications:
  # irc: "irc.freenode.org#pysolr"
  email: false
